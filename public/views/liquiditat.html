<style>
    /* Modern Minimal Liquidity Planning - Kontiq Brand Colors Only */
    
    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 32px;
    }

    .page-title {
        font-size: 28px;
        color: var(--navy);
        font-weight: 700;
        letter-spacing: -0.5px;
    }

    .header-actions {
        display: flex;
        gap: 10px;
    }

    .btn {
        padding: 10px 20px;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        border: none;
        font-family: inherit;
    }

    .btn-primary {
        background: var(--teal);
        color: white;
    }

    .btn-primary:hover {
        background: #059669;
        transform: translateY(-1px);
    }

    .btn-secondary {
        background: white;
        color: var(--navy);
        border: 1.5px solid var(--light-gray);
    }

    .btn-secondary:hover {
        border-color: var(--navy);
    }

    /* Total Liquidity Card */
    .total-liquidity {
        background: var(--navy);
        padding: 32px;
        border-radius: 12px;
        color: white;
        margin-bottom: 32px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.06);
        border: 1px solid rgba(14, 177, 122, 0.2);
    }

    .total-header {
        font-size: 11px;
        opacity: 0.8;
        margin-bottom: 12px;
        text-transform: uppercase;
        letter-spacing: 0.8px;
        font-weight: 600;
    }

    .total-amount {
        font-size: 42px;
        font-weight: 800;
        font-family: 'Roboto Mono', monospace;
        margin-bottom: 24px;
        letter-spacing: -1px;
    }

    .total-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 20px;
    }

    .total-item {
        border-left: 2px solid rgba(14, 177, 122, 0.5);
        padding-left: 16px;
    }

    .total-label {
        font-size: 11px;
        opacity: 0.7;
        margin-bottom: 6px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .total-value {
        font-size: 18px;
        font-weight: 700;
        font-family: 'Roboto Mono', monospace;
    }

    /* Account Cards */
    .accounts-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 16px;
        margin-bottom: 32px;
    }

    .account-card {
        background: var(--white);
        padding: 24px;
        border-radius: 12px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.06);
        border: 1px solid var(--light-gray);
        border-left: 3px solid var(--teal);
        transition: all 0.2s;
    }
    
    .account-card:hover {
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        transform: translateY(-2px);
    }

    .account-header {
        margin-bottom: 16px;
    }

    .account-name {
        font-size: 11px;
        color: var(--gray);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.8px;
        margin-bottom: 4px;
    }

    .account-number {
        font-size: 11px;
        color: var(--gray);
    }

    .account-balance {
        font-size: 28px;
        font-weight: 800;
        color: var(--navy);
        font-family: 'Roboto Mono', monospace;
        margin-bottom: 8px;
        letter-spacing: -0.5px;
    }

    .account-change {
        font-size: 13px;
        font-weight: 600;
    }

    .account-change.positive {
        color: var(--teal);
    }

    .account-change.negative {
        color: var(--navy);
    }

    /* Section Styles */
    .section {
        background: var(--white);
        padding: 24px;
        border-radius: 12px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.06);
        border: 1px solid var(--light-gray);
        margin-bottom: 32px;
    }

    .section-title {
        font-size: 18px;
        font-weight: 700;
        color: var(--navy);
        margin-bottom: 20px;
        letter-spacing: -0.3px;
    }

    /* Cashflow Analysis */
    .cashflow-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 20px;
    }

    .cashflow-card {
        padding: 20px;
        border: 1px solid var(--light-gray);
        border-radius: 10px;
        background: #F9FAFB;
    }

    .cashflow-header {
        margin-bottom: 16px;
    }

    .cashflow-title {
        font-size: 11px;
        font-weight: 600;
        color: var(--gray);
        text-transform: uppercase;
        letter-spacing: 0.8px;
    }

    .cashflow-amount {
        font-size: 28px;
        font-weight: 800;
        font-family: 'Roboto Mono', monospace;
        margin-bottom: 16px;
        letter-spacing: -0.5px;
    }

    .cashflow-list {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .cashflow-item {
        display: flex;
        justify-content: space-between;
        padding: 10px 0;
        border-bottom: 1px solid #E5E7EB;
        font-size: 13px;
        gap: 10px;
    }

    .cashflow-item:last-child {
        border-bottom: none;
    }

    .cashflow-item span:first-child {
        color: var(--gray);
    }

    .cashflow-item span:last-child {
        font-weight: 700;
        color: var(--navy);
        font-family: 'Roboto Mono', monospace;
    }

    /* Chart Container */
    .chart-container {
        position: relative;
        height: 280px;
        margin-top: 20px;
    }

    /* Simulator Form */
    .form-inline {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 16px;
        margin-bottom: 24px;
        padding: 20px;
        background: #F9FAFB;
        border-radius: 10px;
        border: 1px solid var(--light-gray);
    }

    .form-group {
        display: flex;
        flex-direction: column;
        gap: 6px;
    }

    .form-label {
        font-size: 11px;
        color: var(--gray);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .form-input {
        padding: 10px 12px;
        border: 1.5px solid var(--light-gray);
        border-radius: 8px;
        font-size: 14px;
        font-family: 'Roboto Mono', monospace;
        font-weight: 600;
        transition: all 0.2s;
    }

    .form-input:focus {
        outline: none;
        border-color: var(--teal);
        box-shadow: 0 0 0 3px rgba(14, 177, 122, 0.1);
    }

    /* Scenario Comparison */
    .scenario-comparison {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 20px;
        margin-top: 20px;
    }

    .scenario-card {
        border: 1px solid var(--light-gray);
        border-radius: 12px;
        padding: 24px;
        background: white;
        transition: all 0.2s;
    }

    .scenario-card:hover {
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        transform: translateY(-2px);
    }

    .scenario-card.recommended {
        border-color: var(--teal);
        background: rgba(14, 177, 122, 0.03);
    }

    .scenario-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 16px;
        border-bottom: 1px solid var(--light-gray);
    }

    .scenario-title {
        font-size: 14px;
        font-weight: 700;
        color: var(--navy);
    }

    .scenario-badge {
        padding: 4px 10px;
        border-radius: 6px;
        font-size: 10px;
        font-weight: 700;
        text-transform: uppercase;
        background: var(--teal);
        color: white;
        letter-spacing: 0.5px;
    }

    .calc-row {
        display: flex;
        justify-content: space-between;
        padding: 12px 0;
        border-bottom: 1px solid #F3F4F6;
        font-size: 13px;
        gap: 16px;
    }

    .calc-row:last-child {
        border-bottom: none;
    }

    .calc-label {
        color: var(--gray);
    }

    .calc-value {
        font-weight: 700;
        font-family: 'Roboto Mono', monospace;
        color: var(--navy);
    }

    .calc-total {
        margin-top: 16px;
        padding-top: 16px;
        border-top: 2px solid var(--navy);
        display: flex;
        justify-content: space-between;
        font-size: 14px;
        font-weight: 700;
    }

    .calc-total span:last-child {
        font-family: 'Roboto Mono', monospace;
        font-size: 18px;
    }

    /* Recommendation Box */
    .recommendation-box {
        background: #F9FAFB;
        border: 1px solid var(--light-gray);
        border-left: 3px solid var(--teal);
        border-radius: 12px;
        padding: 20px;
        margin-top: 20px;
    }

    .recommendation-title {
        font-size: 15px;
        font-weight: 700;
        color: var(--navy);
        margin-bottom: 10px;
    }

    .recommendation-text {
        font-size: 13px;
        line-height: 1.6;
        color: var(--gray);
    }

    /* Alerts */
    .alert-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 16px;
        margin-top: 20px;
    }

    .alert-item {
        padding: 16px;
        border-radius: 10px;
        border-left: 3px solid var(--navy);
        background: #F9FAFB;
        border: 1px solid var(--light-gray);
        border-left: 3px solid var(--navy);
    }

    .alert-item.success {
        border-left-color: var(--teal);
    }

    .alert-item.warning {
        border-left-color: var(--navy);
    }

    .alert-title {
        font-size: 13px;
        font-weight: 700;
        color: var(--navy);
        margin-bottom: 6px;
    }

    .alert-message {
        font-size: 12px;
        color: var(--gray);
        line-height: 1.5;
    }

    /* Quick Actions */
    .action-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 16px;
        margin-top: 20px;
    }

    .action-card {
        padding: 24px;
        border-radius: 12px;
        border: 1px solid var(--light-gray);
        text-align: center;
        cursor: pointer;
        transition: all 0.2s;
        background: white;
    }

    .action-card:hover {
        border-color: var(--teal);
        background: #F9FAFB;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    .action-icon {
        width: 48px;
        height: 48px;
        background: var(--navy);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 12px;
        color: white;
        font-size: 24px;
    }

    .action-title {
        font-size: 13px;
        font-weight: 600;
        color: var(--navy);
    }

    @media (max-width: 1200px) {
        .accounts-grid {
            grid-template-columns: repeat(2, 1fr);
        }
        .total-grid {
            grid-template-columns: repeat(2, 1fr);
        }
        .form-inline {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    @media (max-width: 768px) {
        .accounts-grid,
        .cashflow-grid,
        .scenario-comparison,
        .alert-grid,
        .action-grid {
            grid-template-columns: 1fr;
        }
        .total-grid {
            grid-template-columns: 1fr;
        }
        .form-inline {
            grid-template-columns: 1fr;
        }
    }
/* Masquer header/menu sur mobile */
@media (max-width: 768px) {
    .sidebar,
    .side-menu,
    .module-list,
    .main-nav,
    .page-header {
        display: none !important;
    }
}

/* ¬ß17 InsO Monitor - CRITICAL ALERT */
.inso-monitor {
    background: linear-gradient(135deg, #DC2626 0%, #B91C1C 100%);
    padding: 24px 32px;
    border-radius: 12px;
    color: white;
    margin-bottom: 24px;
    box-shadow: 0 4px 16px rgba(220, 38, 38, 0.25);
    border: 2px solid #991B1B;
    display: none; /* Hidden by default, shown by JS if triggered */
}

.inso-monitor.warning {
    background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%);
    border-color: #B45309;
}

.inso-monitor.safe {
    background: linear-gradient(135deg, var(--teal) 0%, #059669 100%);
    border-color: #047857;
    box-shadow: 0 4px 16px rgba(14, 177, 122, 0.25);
}

.inso-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
}

.inso-title {
    font-size: 18px;
    font-weight: 800;
    letter-spacing: -0.3px;
    display: flex;
    align-items: center;
    gap: 12px;
}

.inso-icon {
    font-size: 28px;
}

.inso-countdown {
    font-size: 42px;
    font-weight: 800;
    font-family: 'Roboto Mono', monospace;
    letter-spacing: -1px;
}

.inso-body {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 24px;
    align-items: center;
}

.inso-message {
    font-size: 15px;
    line-height: 1.6;
    opacity: 0.95;
}

.inso-message strong {
    font-weight: 700;
    text-decoration: underline;
}

.inso-action {
    text-align: right;
}

.inso-button {
    background: white;
    color: #DC2626;
    padding: 12px 24px;
    border-radius: 8px;
    font-weight: 700;
    font-size: 14px;
    border: none;
    cursor: pointer;
    transition: all 0.2s;
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
}

.inso-monitor.warning .inso-button {
    color: #F59E0B;
}

.inso-monitor.safe .inso-button {
    color: var(--teal);
}

.inso-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

/* 4-Wochen Forecast */
.forecast-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 16px;
    margin-bottom: 24px;
}

.week-card {
    background: white;
    padding: 20px;
    border-radius: 12px;
    border: 1px solid var(--light-gray);
    transition: all 0.2s;
}

.week-card:hover {
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    transform: translateY(-2px);
}

.week-card.critical {
    border-left: 3px solid var(--error);
    background: rgba(220, 38, 38, 0.03);
}

.week-card.warning {
    border-left: 3px solid var(--warning);
    background: rgba(245, 158, 11, 0.03);
}

.week-card.safe {
    border-left: 3px solid var(--teal);
    background: rgba(14, 177, 122, 0.03);
}

.week-header {
    font-size: 11px;
    color: var(--gray);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.8px;
    margin-bottom: 12px;
}

.week-balance {
    font-size: 24px;
    font-weight: 800;
    color: var(--navy);
    font-family: 'Roboto Mono', monospace;
    margin-bottom: 12px;
    letter-spacing: -0.5px;
}

.week-details {
    display: flex;
    flex-direction: column;
    gap: 6px;
    font-size: 12px;
}

.week-in {
    color: var(--teal);
    font-weight: 600;
}

.week-out {
    color: var(--navy);
    font-weight: 600;
}

.week-net {
    font-weight: 700;
    padding-top: 6px;
    border-top: 1px solid var(--light-gray);
}
</style>

<div class="page-header">
    <h1 class="page-title">Liquidit√§tsplanung</h1>
    <div class="header-actions">
        <button class="btn btn-secondary" onclick="openCreditSimulator()">Kredit vs Skonto</button>
        <button class="btn btn-primary" onclick="exportData()">Export</button>
    </div>
</div>

<!-- ¬ß17 InsO MONITOR - CRITICAL ALERT -->
<div class="inso-monitor" id="insoMonitor">
    <div class="inso-header">
        <div class="inso-title">
            <span class="inso-icon" id="insoIcon">‚ö†Ô∏è</span>
            <span id="insoTitle">¬ß17 InsO Warnung</span>
        </div>
        <div class="inso-countdown" id="insoCountdown">12 Tage</div>
    </div>
    <div class="inso-body">
        <div class="inso-message" id="insoMessage">
            <strong>Zahlungsunf√§higkeit droht!</strong> Bei aktueller Ausgabenrate reicht Ihre Liquidit√§t nur noch f√ºr 12 Tage.
            Gem√§√ü <strong>¬ß17 InsO</strong> m√ºssen Sie bei weniger als 21 Tagen Insolvenzantrag stellen.
            <br><br>
            <strong>Sofortma√ünahmen erforderlich:</strong> Zahlungsziele verl√§ngern, Forderungen eintreiben, Kreditlinie nutzen.
        </div>
        <div class="inso-action">
            <button class="inso-button" onclick="showInsoActions()">Ma√ünahmen anzeigen</button>
        </div>
    </div>
</div>

<!-- TOTAL LIQUIDITY -->
<div class="total-liquidity">
    <div class="total-header">Gesamte Liquidit√§t</div>
    <div class="total-amount">58.420‚Ç¨</div>
    <div class="total-grid">
        <div class="total-item">
            <div class="total-label">Verf√ºgbar sofort</div>
            <div class="total-value">45.320‚Ç¨</div>
        </div>
        <div class="total-item">
            <div class="total-label">Tagesgeld</div>
            <div class="total-value">12.000‚Ç¨</div>
        </div>
        <div class="total-item">
            <div class="total-label">Kreditlinie</div>
            <div class="total-value">1.100‚Ç¨</div>
        </div>
        <div class="total-item">
            <div class="total-label">Runway</div>
            <div class="total-value">4,8 Mo.</div>
        </div>
    </div>
</div>

<!-- BANK ACCOUNTS -->
<div class="accounts-grid">
    <div class="account-card">
        <div class="account-header">
            <div class="account-name">Gesch√§ftskonto</div>
            <div class="account-number">DE89 3704 0044 ‚Ä¢‚Ä¢‚Ä¢ 1234</div>
        </div>
        <div class="account-balance">45.320‚Ç¨</div>
        <div class="account-change positive">‚Üó +2.340‚Ç¨ (heute)</div>
    </div>

    <div class="account-card">
        <div class="account-header">
            <div class="account-name">Tagesgeldkonto</div>
            <div class="account-number">DE89 3704 0044 ‚Ä¢‚Ä¢‚Ä¢ 5678</div>
        </div>
        <div class="account-balance">12.000‚Ç¨</div>
        <div class="account-change" style="color: var(--gray);">‚Üí Stabil (2,5% p.a.)</div>
    </div>

    <div class="account-card">
        <div class="account-header">
            <div class="account-name">Kreditlinie</div>
            <div class="account-number">Verf√ºgbar / Limit</div>
        </div>
        <div class="account-balance">1.100‚Ç¨</div>
        <div style="font-size: 12px; color: var(--gray); font-weight: 500;">von 50.000‚Ç¨ genutzt (2,2%)</div>
    </div>
</div>

<!-- 4-WOCHEN CASHFLOW FORECAST -->
<div class="section">
    <div class="section-title">4-Wochen Cashflow Forecast</div>

    <div class="forecast-grid" id="forecastGrid">
        <!-- Week 1 -->
        <div class="week-card safe">
            <div class="week-header">Woche 1 (22.01 - 28.01)</div>
            <div class="week-balance">62.100‚Ç¨</div>
            <div class="week-details">
                <div class="week-in">‚Üó +12.400‚Ç¨ Einnahmen</div>
                <div class="week-out">‚Üò -8.720‚Ç¨ Ausgaben</div>
                <div class="week-net" style="color: var(--teal);">Netto: +3.680‚Ç¨</div>
            </div>
        </div>

        <!-- Week 2 -->
        <div class="week-card safe">
            <div class="week-header">Woche 2 (29.01 - 04.02)</div>
            <div class="week-balance">59.800‚Ç¨</div>
            <div class="week-details">
                <div class="week-in">‚Üó +8.900‚Ç¨ Einnahmen</div>
                <div class="week-out">‚Üò -11.200‚Ç¨ Ausgaben</div>
                <div class="week-net" style="color: var(--navy);">Netto: -2.300‚Ç¨</div>
            </div>
        </div>

        <!-- Week 3 -->
        <div class="week-card warning">
            <div class="week-header">Woche 3 (05.02 - 11.02)</div>
            <div class="week-balance">51.600‚Ç¨</div>
            <div class="week-details">
                <div class="week-in">‚Üó +6.200‚Ç¨ Einnahmen</div>
                <div class="week-out">‚Üò -14.400‚Ç¨ Ausgaben</div>
                <div class="week-net" style="color: var(--error);">Netto: -8.200‚Ç¨</div>
            </div>
        </div>

        <!-- Week 4 -->
        <div class="week-card safe">
            <div class="week-header">Woche 4 (12.02 - 18.02)</div>
            <div class="week-balance">66.440‚Ç¨</div>
            <div class="week-details">
                <div class="week-in">‚Üó +18.240‚Ç¨ Einnahmen</div>
                <div class="week-out">‚Üò -3.400‚Ç¨ Ausgaben</div>
                <div class="week-net" style="color: var(--teal);">Netto: +14.840‚Ç¨</div>
            </div>
        </div>
    </div>

    <div style="margin-top: 24px; padding: 20px; background: #F9FAFB; border-radius: 10px; border: 1px solid var(--light-gray);">
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px;">
            <div>
                <div style="font-size: 11px; color: var(--gray); margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.8px; font-weight: 600;">Gesamte Einnahmen (4W)</div>
                <div style="font-size: 24px; font-weight: 800; color: var(--teal); font-family: 'Roboto Mono', monospace; letter-spacing: -0.5px;">+45.740‚Ç¨</div>
            </div>
            <div>
                <div style="font-size: 11px; color: var(--gray); margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.8px; font-weight: 600;">Gesamte Ausgaben (4W)</div>
                <div style="font-size: 24px; font-weight: 800; color: var(--navy); font-family: 'Roboto Mono', monospace; letter-spacing: -0.5px;">-37.720‚Ç¨</div>
            </div>
            <div style="text-align: right;">
                <div style="font-size: 11px; color: var(--gray); margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.8px; font-weight: 600;">Liquidit√§t nach 4 Wochen</div>
                <div style="font-size: 24px; font-weight: 800; color: var(--teal); font-family: 'Roboto Mono', monospace; letter-spacing: -0.5px;">66.440‚Ç¨</div>
            </div>
        </div>
    </div>
</div>

<!-- KATEGORIEN ANALYSE -->
<div class="section">
    <div class="section-title">Umsatzanalyse nach Kategorien</div>
    <div id="kategorien-analyse-container">
        <div style="text-align: center; padding: 2rem; color: #999;">
            <p>Lade Kategorieanalyse...</p>
        </div>
    </div>
</div>

<!-- LIQUIDITY FORECAST CHART -->
<div class="section">
    <div class="section-title">Liquidit√§tsprognose (90 Tage)</div>
    <div class="chart-container">
        <canvas id="liquidityForecastChart"></canvas>
    </div>
</div>

<!-- CREDIT VS SKONTO SIMULATOR -->
<div class="section">
    <div class="section-title">Szenario: Kredit aufnehmen vs. Skonto nutzen</div>
    
    <div class="form-inline">
        <div class="form-group">
            <label class="form-label">Rechnungsbetrag</label>
            <input type="number" class="form-input" id="invoiceAmount" value="50000" step="100" oninput="updateCalculator()">
        </div>
        <div class="form-group">
            <label class="form-label">Skonto %</label>
            <input type="number" class="form-input" id="skontoRate" value="2" step="0.1" oninput="updateCalculator()">
        </div>
        <div class="form-group">
            <label class="form-label">Skonto Frist (Tage)</label>
            <input type="number" class="form-input" id="skontoDeadline" value="10" oninput="updateCalculator()">
        </div>
        <div class="form-group">
            <label class="form-label">R√ºckzahlung (Tage)</label>
            <input type="number" class="form-input" id="repaymentDays" value="30" oninput="updateCalculator()">
        </div>
    </div>

    <div class="scenario-comparison">
        <div class="scenario-card">
            <div class="scenario-header">
                <div class="scenario-title">Ohne Kredit (Skonto verloren)</div>
            </div>
            <div class="calc-row">
                <span class="calc-label">Rechnungsbetrag</span>
                <span class="calc-value" id="noCredit_amount">50.000‚Ç¨</span>
            </div>
            <div class="calc-row">
                <span class="calc-label">Skonto verpasst</span>
                <span class="calc-value" style="color: var(--navy);" id="noCredit_skonto">-1.000‚Ç¨</span>
            </div>
            <div class="calc-row">
                <span class="calc-label">Kreditkosten</span>
                <span class="calc-value">0‚Ç¨</span>
            </div>
            <div class="calc-total">
                <span>EFFEKTIVE KOSTEN</span>
                <span style="color: var(--navy);" id="noCredit_total">51.000‚Ç¨</span>
            </div>
        </div>

        <div class="scenario-card recommended">
            <div class="scenario-header">
                <div class="scenario-title">Mit Kredit (Skonto nutzen)</div>
                <div class="scenario-badge">Empfohlen</div>
            </div>
            <div class="calc-row">
                <span class="calc-label">Rechnungsbetrag</span>
                <span class="calc-value" id="credit_amount">50.000‚Ç¨</span>
            </div>
            <div class="calc-row">
                <span class="calc-label">Skonto genutzt</span>
                <span class="calc-value" style="color: var(--teal);" id="credit_skonto">-1.000‚Ç¨</span>
            </div>
            <div class="calc-row">
                <span class="calc-label">Kreditzinsen (6,5% p.a.)</span>
                <span class="calc-value" style="color: var(--navy);" id="credit_interest">+267‚Ç¨</span>
            </div>
            <div style="font-size: 11px; color: var(--gray); margin-top: 4px; padding-left: 10px;" id="credit_formula">
                Berechnung: 49.000‚Ç¨ √ó 6,5% √ó (30/365)
            </div>
            <div class="calc-total">
                <span>EFFEKTIVE KOSTEN</span>
                <span style="color: var(--teal);" id="credit_total">49.267‚Ç¨</span>
            </div>
        </div>
    </div>

    <div class="recommendation-box">
        <div class="recommendation-title">ü§ñ Empfehlung: Kredit aufnehmen</div>
        <div class="recommendation-text">
            <strong id="savings_amount">Einsparung: 1.733‚Ç¨</strong><br>
            Durch Nutzung eines Kurzkredits zur Skonto-Ausnutzung sparen Sie <strong id="savings_text">1.733‚Ç¨</strong> gegen√ºber der 
            Zahlung ohne Skonto. Die Kreditkosten sind deutlich niedriger als der Skonto-Verlust.
        </div>
    </div>
</div>

<!-- LIQUIDITY ALERTS -->
<div class="section">
    <div class="section-title">Liquidit√§ts-Warnungen & Hinweise</div>
    <div class="alert-grid">
        <div class="alert-item success">
            <div class="alert-title">‚úì Gesunde Liquidit√§t</div>
            <div class="alert-message">
                Ihre Liquidit√§t liegt 46% √ºber dem Minimum. Runway von 4,8 Monaten ist solide.
            </div>
        </div>
        <div class="alert-item warning">
            <div class="alert-title">‚ö† Hohe Ausgaben KW 52</div>
            <div class="alert-message">
                In Kalenderwoche 52 sind Zahlungen von 18.450‚Ç¨ f√§llig. Saldo sinkt auf 39.870‚Ç¨.
            </div>
        </div>
        <div class="alert-item success">
            <div class="alert-title">‚úì Skonto-Potenzial</div>
            <div class="alert-message">
                545‚Ç¨ Skonto verf√ºgbar. 5 Rechnungen k√∂nnen mit 2% Rabatt bezahlt werden.
            </div>
        </div>
        <div class="alert-item warning">
            <div class="alert-title">‚ö† √úberf√§llige Forderungen</div>
            <div class="alert-message">
                2 Rechnungen √ºberf√§llig (7.200‚Ç¨). Mahnungen empfohlen f√ºr ABC GmbH und Bau Service.
            </div>
        </div>
    </div>
</div>

<!-- QUICK ACTIONS -->
<div class="section">
    <div class="section-title">Schnellzugriff</div>
    <div class="action-grid">
        <div class="action-card" onclick="makePayment()">
            <div class="action-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <polyline points="19 12 12 19 5 12"></polyline>
                </svg>
            </div>
            <div class="action-title">Zahlung t√§tigen</div>
        </div>
        <div class="action-card" onclick="createInvoice()">
            <div class="action-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                    <line x1="12" y1="18" x2="12" y2="12"></line>
                    <line x1="9" y1="15" x2="15" y2="15"></line>
                </svg>
            </div>
            <div class="action-title">Rechnung stellen</div>
        </div>
        <div class="action-card" onclick="exportData()">
            <div class="action-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7 10 12 15 17 10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                </svg>
            </div>
            <div class="action-title">Export</div>
        </div>
        <div class="action-card" onclick="viewAccounts()">
            <div class="action-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                    <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
                    <line x1="1" y1="10" x2="23" y2="10"></line>
                </svg>
            </div>
            <div class="action-title">Konten</div>
        </div>
    </div>
</div>

<script>
    // Chart.js - Modern Clean Style
    function initializeLiquidityChart() {
        const ctx = document.getElementById('liquidityForecastChart');
        if (ctx && typeof Chart !== 'undefined') {
            const context = ctx.getContext('2d');
            const gradient = context.createLinearGradient(0, 0, 0, 280);
            gradient.addColorStop(0, 'rgba(14, 177, 122, 0.08)');
            gradient.addColorStop(1, 'rgba(14, 177, 122, 0)');

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Heute', '+7T', '+14T', '+21T', '+30T', '+45T', '+60T', '+75T', '+90T'],
                    datasets: [{
                        label: 'Liquidit√§t',
                        data: [58420, 62100, 59800, 63200, 75460, 78200, 81400, 79800, 84200],
                        borderColor: '#0EB17A',
                        backgroundColor: gradient,
                        borderWidth: 2.5,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0,
                        pointHoverRadius: 6,
                        pointHoverBackgroundColor: '#0EB17A',
                        pointHoverBorderColor: '#FFFFFF',
                        pointHoverBorderWidth: 2
                    },
                    {
                        label: 'Minimum (40.000‚Ç¨)',
                        data: [40000, 40000, 40000, 40000, 40000, 40000, 40000, 40000, 40000],
                        borderColor: 'rgba(10, 37, 64, 0.2)',
                        borderDash: [8, 4],
                        borderWidth: 1.5,
                        fill: false,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: '#0A2540',
                            padding: 12,
                            cornerRadius: 8,
                            titleFont: { size: 13, weight: 600 },
                            bodyFont: { size: 13 },
                            callbacks: {
                                label: function(context) {
                                    if (context.dataset.label === 'Liquidit√§t') {
                                        return 'Liquidit√§t: ' + context.parsed.y.toLocaleString('de-DE') + ' ‚Ç¨';
                                    }
                                    return null;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 30000,
                            max: 90000,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.04)',
                                drawBorder: false
                            },
                            ticks: {
                                callback: function(value) {
                                    return (value / 1000) + 'k ‚Ç¨';
                                },
                                color: '#6B7280',
                                font: { size: 11 }
                            }
                        },
                        x: {
                            grid: {
                                display: false,
                                drawBorder: false
                            },
                            ticks: {
                                color: '#6B7280',
                                font: { size: 11 }
                            }
                        }
                    }
                }
            });
        } else if (!ctx || typeof Chart === 'undefined') {
            // Retry after a short delay if elements aren't ready
            setTimeout(initializeLiquidityChart, 100);
        }
    }

    // Initialize chart when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeLiquidityChart);
    } else {
        initializeLiquidityChart();
    }

    // Calculator Update Function
    function updateCalculator() {
        const amount = parseFloat(document.getElementById('invoiceAmount').value) || 0;
        const skontoRate = parseFloat(document.getElementById('skontoRate').value) || 0;
        const days = parseInt(document.getElementById('repaymentDays').value) || 0;
        
        const skontoSavings = amount * (skontoRate / 100);
        const creditAmount = amount - skontoSavings;
        const creditCost = creditAmount * (6.5 / 100) * (days / 365);
        
        const noCreditTotal = amount + skontoSavings;
        const withCreditTotal = amount - skontoSavings + creditCost;
        const savings = noCreditTotal - withCreditTotal;
        
        // Format currency
        const fmt = (val) => val.toLocaleString('de-DE', {minimumFractionDigits: 0, maximumFractionDigits: 0}) + '‚Ç¨';
        const fmtDecimal = (val) => val.toLocaleString('de-DE', {minimumFractionDigits: 0, maximumFractionDigits: 0}) + '‚Ç¨';
        
        // Update Without Credit
        document.getElementById('noCredit_amount').textContent = fmt(amount);
        document.getElementById('noCredit_skonto').textContent = '-' + fmt(skontoSavings);
        document.getElementById('noCredit_total').textContent = fmt(noCreditTotal);
        
        // Update With Credit
        document.getElementById('credit_amount').textContent = fmt(amount);
        document.getElementById('credit_skonto').textContent = '-' + fmt(skontoSavings);
        document.getElementById('credit_interest').textContent = '+' + fmtDecimal(creditCost);
        document.getElementById('credit_total').textContent = fmtDecimal(withCreditTotal);
        document.getElementById('credit_formula').textContent = 
            `Berechnung: ${fmtDecimal(creditAmount)} √ó 6,5% √ó (${days}/365)`;
        
        // Update Recommendation
        document.getElementById('savings_amount').textContent = `Einsparung: ${fmtDecimal(savings)}`;
        document.getElementById('savings_text').textContent = fmtDecimal(savings);
    }

    // Action Functions
    function openCreditSimulator() {
        const section = document.querySelector('.section:nth-child(5)');
        section.scrollIntoView({ behavior: 'smooth' });
        document.getElementById('invoiceAmount').focus();
    }

    function makePayment() {
        alert('Zahlung vorbereiten...\n\nWeitergeleitet zu Zahlungsmanagement');
    }

    function createInvoice() {
        alert('Rechnung erstellen...\n\nFunktion wird geladen');
    }

    function exportData() {
        alert('Export wird vorbereitet...\n\nDaten werden als Excel-Datei heruntergeladen');
    }

    function viewAccounts() {
        alert('Konto√ºbersicht √∂ffnen...\n\nBankkonten Details anzeigen');
    }

    // Initialize calculator on load
    updateCalculator();

    // ======================
    // ¬ß17 InsO MONITOR
    // ======================
    async function calculateInsoStatus() {
        try {
            const token = localStorage.getItem('kontiq_token');
            const currentEntity = localStorage.getItem('kontiq_current_entity');

            // Fetch data
            const [zahlungenRes, kostenRes, bankkontenRes] = await Promise.all([
                fetch('/api/zahlungen', { headers: { 'Authorization': `Bearer ${token}` }}),
                fetch('/api/kosten', { headers: { 'Authorization': `Bearer ${token}` }}),
                fetch('/api/bankkonten', { headers: { 'Authorization': `Bearer ${token}` }})
            ]);

            const zahlungen = await zahlungenRes.json();
            const kosten = await kostenRes.json();
            const bankkonten = await bankkontenRes.json();

            // Calculate current liquidity
            const totalLiquidity = bankkonten
                .filter(b => !currentEntity || b.entityId === currentEntity)
                .reduce((sum, b) => sum + (parseFloat(b.balance) || 0), 0);

            // Calculate average daily burn rate (last 30 days of kosten)
            const today = new Date();
            const thirtyDaysAgo = new Date(today.getTime() - 30 * 24 * 60 * 60 * 1000);

            const recentKosten = kosten.filter(k => {
                if (currentEntity && k.entityId !== currentEntity) return false;
                const kDate = new Date(k.date);
                return kDate >= thirtyDaysAgo && kDate <= today;
            });

            const totalBurn = recentKosten.reduce((sum, k) => sum + Math.abs(parseFloat(k.amount) || 0), 0);
            const dailyBurnRate = totalBurn / 30;

            // Calculate runway in days
            const runwayDays = dailyBurnRate > 0 ? Math.floor(totalLiquidity / dailyBurnRate) : 999;

            // Update InsO Monitor
            const monitor = document.getElementById('insoMonitor');
            const icon = document.getElementById('insoIcon');
            const title = document.getElementById('insoTitle');
            const countdown = document.getElementById('insoCountdown');
            const message = document.getElementById('insoMessage');

            if (runwayDays < 21) {
                // CRITICAL - Less than 21 days (¬ß17 InsO threshold)
                monitor.classList.remove('warning', 'safe');
                monitor.style.display = 'block';
                icon.textContent = 'üö®';
                title.textContent = '¬ß17 InsO KRITISCH';
                countdown.textContent = `${runwayDays} Tage`;
                message.innerHTML = `
                    <strong>Zahlungsunf√§higkeit droht!</strong> Bei aktueller Ausgabenrate reicht Ihre Liquidit√§t nur noch f√ºr ${runwayDays} Tage.
                    Gem√§√ü <strong>¬ß17 InsO</strong> m√ºssen Sie bei weniger als 21 Tagen Insolvenzantrag stellen.
                    <br><br>
                    <strong>Sofortma√ünahmen erforderlich:</strong> Zahlungsziele verl√§ngern, Forderungen eintreiben, Kreditlinie nutzen (${totalLiquidity.toLocaleString('de-DE', {minimumFractionDigits: 0, maximumFractionDigits: 0})}‚Ç¨ verf√ºgbar).
                `;
            } else if (runwayDays < 45) {
                // WARNING - Less than 45 days
                monitor.classList.remove('safe');
                monitor.classList.add('warning');
                monitor.style.display = 'block';
                icon.textContent = '‚ö†Ô∏è';
                title.textContent = '¬ß17 InsO Warnung';
                countdown.textContent = `${runwayDays} Tage`;
                message.innerHTML = `
                    <strong>Liquidit√§t beobachten!</strong> Ihre Liquidit√§t reicht aktuell f√ºr ${runwayDays} Tage.
                    Die gesetzliche ¬ß17 InsO Schwelle liegt bei 21 Tagen.
                    <br><br>
                    <strong>Empfehlung:</strong> Cashflow optimieren, offene Forderungen eintreiben, unn√∂tige Ausgaben reduzieren.
                `;
            } else if (runwayDays < 90) {
                // SAFE but show info
                monitor.classList.remove('warning');
                monitor.classList.add('safe');
                monitor.style.display = 'block';
                icon.textContent = '‚úÖ';
                title.textContent = 'Liquidit√§t: Gesund';
                countdown.textContent = `${runwayDays} Tage`;
                message.innerHTML = `
                    <strong>Liquidit√§t ist gesund!</strong> Ihre Runway betr√§gt ${runwayDays} Tage (${(runwayDays/30).toFixed(1)} Monate).
                    Sie liegen deutlich √ºber der ¬ß17 InsO Schwelle von 21 Tagen.
                    <br><br>
                    Durchschnittliche Ausgaben: ${dailyBurnRate.toLocaleString('de-DE', {minimumFractionDigits: 0, maximumFractionDigits: 0})}‚Ç¨/Tag
                `;
            } else {
                // Excellent - hide monitor
                monitor.style.display = 'none';
            }
        } catch (error) {
            console.error('Error calculating InsO status:', error);
        }
    }

    // ======================
    // 4-WOCHEN FORECAST
    // ======================
    async function calculate4WeekForecast() {
        try {
            const token = localStorage.getItem('kontiq_token');
            const currentEntity = localStorage.getItem('kontiq_current_entity');

            // Fetch data
            const [forderungenRes, zahlungenRes, kostenRes, bankkontenRes] = await Promise.all([
                fetch('/api/forderungen', { headers: { 'Authorization': `Bearer ${token}` }}),
                fetch('/api/zahlungen', { headers: { 'Authorization': `Bearer ${token}` }}),
                fetch('/api/kosten', { headers: { 'Authorization': `Bearer ${token}` }}),
                fetch('/api/bankkonten', { headers: { 'Authorization': `Bearer ${token}` }})
            ]);

            const forderungen = await forderungenRes.json();
            const zahlungen = await zahlungenRes.json();
            const kosten = await kostenRes.json();
            const bankkonten = await bankkontenRes.json();

            // Get current liquidity
            const currentLiquidity = bankkonten
                .filter(b => !currentEntity || b.entityId === currentEntity)
                .reduce((sum, b) => sum + (parseFloat(b.balance) || 0), 0);

            // Calculate forecast for 4 weeks
            const today = new Date();
            const weeks = [];

            for (let w = 0; w < 4; w++) {
                const weekStart = new Date(today.getTime() + w * 7 * 24 * 60 * 60 * 1000);
                const weekEnd = new Date(weekStart.getTime() + 7 * 24 * 60 * 60 * 1000);

                // Expected income from forderungen (due this week)
                const weekIncome = forderungen
                    .filter(f => {
                        if (currentEntity && f.entityId !== currentEntity) return false;
                        if (f.status === 'bezahlt') return false;
                        const dueDate = new Date(f.due_date);
                        return dueDate >= weekStart && dueDate < weekEnd;
                    })
                    .reduce((sum, f) => sum + (parseFloat(f.amount) || 0), 0);

                // Expected expenses from kosten (recurring + scheduled)
                const weekExpenses = kosten
                    .filter(k => {
                        if (currentEntity && k.entityId !== currentEntity) return false;
                        const kDate = new Date(k.date);
                        return kDate >= weekStart && kDate < weekEnd;
                    })
                    .reduce((sum, k) => sum + Math.abs(parseFloat(k.amount) || 0), 0);

                const netCashflow = weekIncome - weekExpenses;
                const endBalance = w === 0 ?
                    currentLiquidity + netCashflow :
                    weeks[w-1].endBalance + netCashflow;

                weeks.push({
                    weekNum: w + 1,
                    start: weekStart,
                    end: weekEnd,
                    income: weekIncome,
                    expenses: weekExpenses,
                    net: netCashflow,
                    endBalance: endBalance
                });
            }

            // Render forecast
            renderForecastGrid(weeks, currentLiquidity);

        } catch (error) {
            console.error('Error calculating 4-week forecast:', error);
        }
    }

    function renderForecastGrid(weeks, currentLiquidity) {
        const grid = document.getElementById('forecastGrid');
        if (!grid) return;

        const today = new Date();
        const fmt = (val) => Math.abs(val).toLocaleString('de-DE', {minimumFractionDigits: 0, maximumFractionDigits: 0}) + '‚Ç¨';

        grid.innerHTML = weeks.map((week, idx) => {
            const startStr = week.start.toLocaleDateString('de-DE', { day: '2-digit', month: '2-digit' });
            const endStr = week.end.toLocaleDateString('de-DE', { day: '2-digit', month: '2-digit' });

            // Determine card status
            let cardClass = 'week-card ';
            if (week.endBalance < 20000) cardClass += 'critical';
            else if (week.endBalance < 40000) cardClass += 'warning';
            else cardClass += 'safe';

            const netColor = week.net >= 0 ? 'var(--teal)' : 'var(--error)';
            const netSign = week.net >= 0 ? '+' : '-';

            return `
                <div class="${cardClass}">
                    <div class="week-header">Woche ${week.weekNum} (${startStr} - ${endStr})</div>
                    <div class="week-balance">${fmt(week.endBalance)}</div>
                    <div class="week-details">
                        <div class="week-in">‚Üó +${fmt(week.income)} Einnahmen</div>
                        <div class="week-out">‚Üò -${fmt(week.expenses)} Ausgaben</div>
                        <div class="week-net" style="color: ${netColor};">Netto: ${netSign}${fmt(week.net)}</div>
                    </div>
                </div>
            `;
        }).join('');
    }

    function showInsoActions() {
        alert(`¬ß17 InsO Sofortma√ünahmen:

1. Forderungsmanagement
   ‚Üí √úberf√§llige Rechnungen sofort mahnen
   ‚Üí Skonto anbieten f√ºr schnelle Zahlung
   ‚Üí Factoring pr√ºfen

2. Ausgaben reduzieren
   ‚Üí Nicht-kritische Zahlungen verschieben
   ‚Üí Zahlungsziele mit Lieferanten neu verhandeln
   ‚Üí Variable Kosten sofort k√ºrzen

3. Liquidit√§t beschaffen
   ‚Üí Kreditlinie aussch√∂pfen
   ‚Üí Kurzfristigen Kredit aufnehmen
   ‚Üí Gesellschafter-Darlehen pr√ºfen

4. Rechtliche Schritte
   ‚Üí Steuerberater/Insolvenzberater konsultieren
   ‚Üí IDW S11 Dokumentation vorbereiten
   ‚Üí Bei Zahlungsunf√§higkeit: Insolvenzantrag binnen 3 Wochen`);
    }

    // Load on page init
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
            calculateInsoStatus();
            calculate4WeekForecast();
        });
    } else {
        calculateInsoStatus();
        calculate4WeekForecast();
    }

    // ======================
    // KATEGORIEN ANALYSE
    // ======================

    async function loadKategorienAnalyse() {
        try {
            // Load category analysis
            await kategorienAnalyse.load();

            // Render detailed analysis
            kategorienAnalyse.renderDetailedAnalysis('kategorien-analyse-container');
        } catch (error) {
            console.error('Error loading kategorien analyse:', error);
            document.getElementById('kategorien-analyse-container').innerHTML = `
                <div style="text-align: center; padding: 2rem; color: #999;">
                    <p>Fehler beim Laden der Kategorieanalyse</p>
                    <button onclick="loadKategorienAnalyse()" class="btn btn-secondary" style="margin-top: 1rem;">Erneut versuchen</button>
                </div>
            `;
        }
    }

    // Load category analysis on page load
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', loadKategorienAnalyse);
    } else {
        loadKategorienAnalyse();
    }
</script>