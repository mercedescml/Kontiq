<!-- STEUERN MODULE -->
<div class="module-header">
    <h1>Steuern</h1>
    <p>√úbersicht √ºber Umsatzsteuer und Vorsteuer f√ºr Ihre Steuererkl√§rung</p>
</div>

<!-- Tax Overview Cards -->
<div class="cashflow-grid" style="margin-bottom: 24px;">
    <div class="cashflow-card">
        <div class="tax-card-label">Umsatzsteuer (erhalten)</div>
        <div class="tax-card-amount" style="color: var(--teal);" id="steuer-erhalten-total">‚Ç¨0,00</div>
        <div class="tax-card-subtitle">Aus Forderungen</div>
    </div>

    <div class="cashflow-card">
        <div class="tax-card-label">Vorsteuer (gezahlt)</div>
        <div class="tax-card-amount" style="color: var(--navy);" id="steuer-gezahlt-total">‚Ç¨0,00</div>
        <div class="tax-card-subtitle">Aus Zahlungen</div>
    </div>

    <div class="cashflow-card">
        <div class="tax-card-label">Zahllast / Erstattung</div>
        <div class="tax-card-amount" id="steuer-zahllast">‚Ç¨0,00</div>
        <div class="tax-card-subtitle" id="steuer-zahllast-label">Zu zahlen</div>
    </div>

    <div class="cashflow-card">
        <div class="tax-card-label">Zeitraum</div>
        <div style="margin-top: 12px;">
            <select id="steuer-zeitraum" onchange="loadSteuernData()" style="width: 100%; padding: 10px 12px; border: 1px solid var(--border-gray); border-radius: 8px; font-size: 13px; font-family: 'Inter', sans-serif;">
                <option value="current-month">Aktueller Monat</option>
                <option value="last-month">Letzter Monat</option>
                <option value="current-quarter">Aktuelles Quartal</option>
                <option value="last-quarter">Letztes Quartal</option>
                <option value="current-year" selected>Aktuelles Jahr</option>
                <option value="last-year">Letztes Jahr</option>
            </select>
        </div>
    </div>
</div>

<!-- Tax Breakdown by Rate -->
<div class="section">
    <div class="section-title">Aufschl√ºsselung nach Steuers√§tzen</div>
    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 16px; margin-top: 16px;">
        <div class="cashflow-card">
            <div class="tax-rate-title">19% MwSt.</div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 16px;">
                <div>
                    <div class="tax-split-label">Erhalten</div>
                    <div class="tax-split-amount" style="color: var(--teal);" id="steuer-19-erhalten">‚Ç¨0,00</div>
                </div>
                <div>
                    <div class="tax-split-label">Gezahlt</div>
                    <div class="tax-split-amount" style="color: var(--navy);" id="steuer-19-gezahlt">‚Ç¨0,00</div>
                </div>
            </div>
        </div>

        <div class="cashflow-card">
            <div class="tax-rate-title">7% MwSt.</div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 16px;">
                <div>
                    <div class="tax-split-label">Erhalten</div>
                    <div class="tax-split-amount" style="color: var(--teal);" id="steuer-7-erhalten">‚Ç¨0,00</div>
                </div>
                <div>
                    <div class="tax-split-label">Gezahlt</div>
                    <div class="tax-split-amount" style="color: var(--navy);" id="steuer-7-gezahlt">‚Ç¨0,00</div>
                </div>
            </div>
        </div>

        <div class="cashflow-card">
            <div class="tax-rate-title">0% MwSt. (Steuerbefreit)</div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 16px;">
                <div>
                    <div class="tax-split-label">Erhalten</div>
                    <div class="tax-split-amount" style="color: var(--teal);" id="steuer-0-erhalten">‚Ç¨0,00</div>
                </div>
                <div>
                    <div class="tax-split-label">Gezahlt</div>
                    <div class="tax-split-amount" style="color: var(--navy);" id="steuer-0-gezahlt">‚Ç¨0,00</div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Tax Optimization Tips -->
<div class="section" style="margin-top: 24px;">
    <div class="section-title">Steueroptimierung & Empfehlungen</div>
    <div id="tax-advice-container"></div>
</div>

<!-- Detailed Lists -->
<div class="section" style="margin-top: 24px;">
    <div class="section-title">Erhaltene Umsatzsteuer (Forderungen)</div>
    <div class="invoices-table" style="margin-top: 16px;">
        <div class="tax-row" style="background: var(--light-gray); border-bottom: 2px solid var(--border-gray); font-weight: 600; color: var(--navy); font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px;">
            <div>Rechnung</div>
            <div>Kunde</div>
            <div>Datum</div>
            <div>Netto</div>
            <div>MwSt. %</div>
            <div>Steuerbetrag</div>
            <div>Brutto</div>
        </div>
        <div id="steuer-forderungen-list"></div>
    </div>
</div>

<div class="section" style="margin-top: 24px;">
    <div class="section-title">Gezahlte Vorsteuer (Zahlungen)</div>
    <div class="invoices-table" style="margin-top: 16px;">
        <div class="tax-row" style="background: var(--light-gray); border-bottom: 2px solid var(--border-gray); font-weight: 600; color: var(--navy); font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px;">
            <div>Lieferant</div>
            <div>Beschreibung</div>
            <div>Datum</div>
            <div>Netto</div>
            <div>MwSt. %</div>
            <div>Steuerbetrag</div>
            <div>Brutto</div>
        </div>
        <div id="steuer-zahlungen-list"></div>
    </div>
</div>

<!-- Expert Consultation -->
<div class="section" style="margin-top: 24px;">
    <div class="section-title">Steuerberater Konsultation</div>
    <div style="background: var(--light-gray); padding: 20px; border-radius: 12px; border-left: 3px solid var(--teal);">
        <div style="display: flex; align-items: start; gap: 16px;">
            <div style="font-size: 32px;">üë®‚Äçüíº</div>
            <div style="flex: 1;">
                <div style="font-size: 16px; font-weight: 700; color: var(--navy); margin-bottom: 8px;">Professionelle Unterst√ºtzung bei der Steuererkl√§rung</div>
                <div style="font-size: 13px; color: var(--gray); margin-bottom: 16px;">
                    Unsere zertifizierten Steuerberater helfen Ihnen, Ihre Steuerlast zu optimieren und alle Vorteile zu nutzen.
                </div>
                <div id="steuerberater-recommendations" style="margin-bottom: 16px;"></div>
                <button onclick="showSteuerberaterList()" style="background: var(--teal); color: white; padding: 10px 20px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 13px;">
                    Steuerberater finden
                </button>
            </div>
        </div>
    </div>
</div>

<style>
.section {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.section-title {
    font-size: 18px;
    font-weight: 700;
    color: var(--navy);
    margin-bottom: 1rem;
    font-family: 'Inter', sans-serif;
}

/* Tax Card Styling */
.tax-card-label {
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--gray);
    margin-bottom: 12px;
}

.tax-card-amount {
    font-size: 28px;
    font-weight: 700;
    font-family: 'Roboto Mono', monospace;
    line-height: 1.2;
    margin-bottom: 8px;
}

.tax-card-subtitle {
    font-size: 11px;
    font-weight: 500;
    color: var(--gray);
    margin-top: 8px;
}

/* Tax Rate Breakdown Card Styling */
.tax-rate-title {
    font-size: 15px;
    font-weight: 700;
    color: var(--navy);
    padding-bottom: 12px;
    border-bottom: 1px solid var(--light-gray);
}

.tax-split-label {
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.3px;
    color: var(--gray);
    margin-bottom: 6px;
}

.tax-split-amount {
    font-size: 20px;
    font-weight: 700;
    font-family: 'Roboto Mono', monospace;
    line-height: 1.2;
}

.tax-row {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 1rem;
    padding: 1rem;
    border-bottom: 1px solid var(--border-gray);
    align-items: center;
    font-size: 13px;
}

.tax-row:hover:not(:first-child) {
    background: var(--light-gray);
}

.tax-row > div {
    font-family: 'Inter', sans-serif;
}

/* Header row styling - will be applied via inline styles and kontiq-typography.css */
</style>

<script>
let steuernData = {
    forderungen: [],
    zahlungen: []
};

async function loadSteuernData() {
    try {
        // Load Forderungen
        const forderungenResponse = await fetch('/api/forderungen');
        if (!forderungenResponse.ok) throw new Error('Fehler beim Laden der Forderungen');
        const forderungenData = await forderungenResponse.json();
        steuernData.forderungen = forderungenData.forderungen || forderungenData;

        // Load Zahlungen
        const zahlungenResponse = await fetch('/api/zahlungen');
        if (!zahlungenResponse.ok) throw new Error('Fehler beim Laden der Zahlungen');
        const zahlungenData = await zahlungenResponse.json();
        steuernData.zahlungen = zahlungenData.zahlungen || zahlungenData;

        // Calculate and display tax summary
        calculateTaxSummary();
        renderForderungenList();
        renderZahlungenList();
        generateTaxAdvice();
        generateSteuerberaterRecommendations();
    } catch (error) {
        console.error('Error loading Steuern data:', error);
    }
}

function calculateTaxSummary() {
    // Calculate received tax (from Forderungen)
    const forderungenByRate = {
        0: { erhalten: 0, count: 0 },
        7: { erhalten: 0, count: 0 },
        19: { erhalten: 0, count: 0 }
    };

    let totalErhalten = 0;

    steuernData.forderungen.forEach(f => {
        const rate = f.steuer_rate || 0;
        const betrag = f.steuer_betrag || 0;

        if (!forderungenByRate[rate]) {
            forderungenByRate[rate] = { erhalten: 0, count: 0 };
        }

        forderungenByRate[rate].erhalten += betrag;
        forderungenByRate[rate].count += 1;
        totalErhalten += betrag;
    });

    // Calculate paid tax (from Zahlungen)
    const zahlungenByRate = {
        0: { gezahlt: 0, count: 0 },
        7: { gezahlt: 0, count: 0 },
        19: { gezahlt: 0, count: 0 }
    };

    let totalGezahlt = 0;

    steuernData.zahlungen.forEach(z => {
        const rate = z.steuer_rate || 0;
        const betrag = z.steuer_betrag || 0;

        if (!zahlungenByRate[rate]) {
            zahlungenByRate[rate] = { gezahlt: 0, count: 0 };
        }

        zahlungenByRate[rate].gezahlt += betrag;
        zahlungenByRate[rate].count += 1;
        totalGezahlt += betrag;
    });

    // Calculate Zahllast (tax liability)
    const zahllast = totalErhalten - totalGezahlt;

    // Update summary cards
    document.getElementById('steuer-erhalten-total').textContent = formatCurrency(totalErhalten);
    document.getElementById('steuer-gezahlt-total').textContent = formatCurrency(totalGezahlt);
    document.getElementById('steuer-zahllast').textContent = formatCurrency(Math.abs(zahllast));
    document.getElementById('steuer-zahllast').style.color = zahllast >= 0 ? 'var(--navy)' : 'var(--teal)';
    document.getElementById('steuer-zahllast-label').textContent = zahllast >= 0 ? 'Zu zahlen' : 'Erstattung';

    // Update rate breakdown
    document.getElementById('steuer-19-erhalten').textContent = formatCurrency(forderungenByRate[19]?.erhalten || 0);
    document.getElementById('steuer-19-gezahlt').textContent = formatCurrency(zahlungenByRate[19]?.gezahlt || 0);

    document.getElementById('steuer-7-erhalten').textContent = formatCurrency(forderungenByRate[7]?.erhalten || 0);
    document.getElementById('steuer-7-gezahlt').textContent = formatCurrency(zahlungenByRate[7]?.gezahlt || 0);

    document.getElementById('steuer-0-erhalten').textContent = formatCurrency(forderungenByRate[0]?.erhalten || 0);
    document.getElementById('steuer-0-gezahlt').textContent = formatCurrency(zahlungenByRate[0]?.gezahlt || 0);
}

function renderForderungenList() {
    const container = document.getElementById('steuer-forderungen-list');

    if (!steuernData.forderungen || steuernData.forderungen.length === 0) {
        container.innerHTML = `
            <div style="padding: 2rem; text-align: center; color: var(--gray);">
                <p>Keine Forderungen vorhanden</p>
            </div>
        `;
        return;
    }

    container.innerHTML = steuernData.forderungen.map(f => {
        const date = new Date(f.invoice_date).toLocaleDateString('de-DE', { day: '2-digit', month: '2-digit', year: 'numeric' });

        return `
            <div class="tax-row">
                <div style="font-weight: 600;">${f.invoice_number || 'N/A'}</div>
                <div>${f.client_name || 'N/A'}</div>
                <div>${date}</div>
                <div>${formatCurrency(f.netto_betrag || 0)}</div>
                <div><span class="badge" style="background: var(--light-gray); color: var(--navy); border: 1px solid var(--border-gray);">${f.steuer_rate || 0}%</span></div>
                <div style="font-weight: 700; color: var(--teal);">${formatCurrency(f.steuer_betrag || 0)}</div>
                <div style="font-weight: 600;">${formatCurrency(f.brutto_betrag || f.amount || 0)}</div>
            </div>
        `;
    }).join('');
}

function renderZahlungenList() {
    const container = document.getElementById('steuer-zahlungen-list');

    if (!steuernData.zahlungen || steuernData.zahlungen.length === 0) {
        container.innerHTML = `
            <div style="padding: 2rem; text-align: center; color: var(--gray);">
                <p>Keine Zahlungen vorhanden</p>
            </div>
        `;
        return;
    }

    container.innerHTML = steuernData.zahlungen.map(z => {
        const date = new Date(z.date).toLocaleDateString('de-DE', { day: '2-digit', month: '2-digit', year: 'numeric' });

        return `
            <div class="tax-row">
                <div style="font-weight: 600;">${z.supplier || z.recipient || 'N/A'}</div>
                <div>${z.description || 'N/A'}</div>
                <div>${date}</div>
                <div>${formatCurrency(z.netto_betrag || 0)}</div>
                <div><span class="badge" style="background: var(--light-gray); color: var(--navy); border: 1px solid var(--border-gray);">${z.steuer_rate || 0}%</span></div>
                <div style="font-weight: 700; color: var(--navy);">${formatCurrency(z.steuer_betrag || 0)}</div>
                <div style="font-weight: 600;">${formatCurrency(z.brutto_betrag || z.amount || 0)}</div>
            </div>
        `;
    }).join('');
}

function formatCurrency(amount) {
    return new Intl.NumberFormat('de-DE', {
        style: 'currency',
        currency: 'EUR',
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
    }).format(amount);
}

// Tax Advice Generator
function generateTaxAdvice() {
    const totalErhalten = steuernData.forderungen.reduce((sum, f) => sum + (f.steuer_betrag || 0), 0);
    const totalGezahlt = steuernData.zahlungen.reduce((sum, z) => sum + (z.steuer_betrag || 0), 0);
    const zahllast = totalErhalten - totalGezahlt;

    const advice = [];

    // Advice based on tax liability
    if (zahllast > 5000) {
        advice.push({
            icon: 'üí°',
            title: 'Hohe Zahllast optimieren',
            description: `Ihre Zahllast betr√§gt ${formatCurrency(zahllast)}. Pr√ºfen Sie folgende Optimierungen:`,
            tips: [
                'Ausgaben vorziehen: Planen Sie notwendige Investitionen noch in diesem Jahr',
                'Vorsteuerabzug maximieren: Pr√ºfen Sie alle abzugsf√§higen Ausgaben',
                'Kleinbetragsrechnungen: Achten Sie auf korrekte Dokumentation',
                'Umsatzsteuersondervorauszahlung: Erw√§gen Sie eine Verteilung der Last'
            ]
        });
    }

    // Advice for high input tax
    const taxByRate = {
        19: { vorsteuer: 0, umsatzsteuer: 0 },
        7: { vorsteuer: 0, umsatzsteuer: 0 }
    };

    steuernData.forderungen.forEach(f => {
        const rate = f.steuer_rate || 0;
        if (taxByRate[rate]) taxByRate[rate].umsatzsteuer += f.steuer_betrag || 0;
    });

    steuernData.zahlungen.forEach(z => {
        const rate = z.steuer_rate || 0;
        if (taxByRate[rate]) taxByRate[rate].vorsteuer += z.steuer_betrag || 0;
    });

    // Advice based on invoice/payment distribution
    const zeroTaxInvoices = steuernData.forderungen.filter(f => (f.steuer_rate || 0) === 0);
    if (zeroTaxInvoices.length > 2) {
        advice.push({
            icon: 'üìã',
            title: 'Steuerfreie Ums√§tze dokumentieren',
            description: `Sie haben ${zeroTaxInvoices.length} steuerfreie Rechnungen. Wichtige Hinweise:`,
            tips: [
                'Reverse Charge: Bei EU-Gesch√§ften Umsatzsteuer-ID des Kunden dokumentieren',
                'Kleinunternehmerregelung: Pflichtangaben auf Rechnung nicht vergessen',
                'Steuerbefreiungen: Rechtliche Grundlage auf Rechnung angeben',
                'Vorsteuerabzug: Bei steuerfreien Ums√§tzen meist ausgeschlossen'
            ]
        });
    }

    // Advice for tax rate distribution
    if (taxByRate[7].umsatzsteuer > taxByRate[19].umsatzsteuer * 0.5) {
        advice.push({
            icon: 'üè∑Ô∏è',
            title: 'Erm√§√üigter Steuersatz (7%)',
            description: 'Bedeutender Anteil Ihrer Ums√§tze unterliegt dem erm√§√üigten Steuersatz:',
            tips: [
                'Pr√ºfen Sie regelm√§√üig die Berechtigung f√ºr den erm√§√üigten Satz',
                'Lebensmittel, B√ºcher, kulturelle Leistungen: Dokumentation sicherstellen',
                'Bei Zweifelsf√§llen: Steuerberater konsultieren',
                'Korrekte Zuordnung verhindert Nachzahlungen bei Betriebspr√ºfungen'
            ]
        });
    }

    // General optimization advice
    if (advice.length === 0 || zahllast < 1000) {
        advice.push({
            icon: '‚úÖ',
            title: 'Gute Steuersituation',
            description: 'Ihre aktuelle Steuersituation ist ausgeglichen. Einige allgemeine Tipps:',
            tips: [
                'Monatliche Umsatzsteuervoranmeldung: P√ºnktliche Abgabe vermeidet S√§umniszuschl√§ge',
                'Belegarchivierung: Digital und rechtssicher f√ºr 10 Jahre aufbewahren',
                'Investitionsabzugsbetrag: F√ºr geplante Anschaffungen nutzen',
                'Regelm√§√üige Kontrolle: Quartalsweise Ihre Steuersituation √ºberpr√ºfen'
            ]
        });
    }

    const container = document.getElementById('tax-advice-container');
    container.innerHTML = advice.map(item => `
        <div style="background: white; border: 1px solid var(--border-gray); border-radius: 12px; padding: 16px; margin-bottom: 16px;">
            <div style="display: flex; align-items: start; gap: 12px;">
                <div style="font-size: 24px;">${item.icon}</div>
                <div style="flex: 1;">
                    <div style="font-size: 15px; font-weight: 700; color: var(--navy); margin-bottom: 6px;">${item.title}</div>
                    <div style="font-size: 13px; color: var(--gray); margin-bottom: 12px;">${item.description}</div>
                    <ul style="margin: 0; padding-left: 20px; font-size: 13px; color: var(--navy); line-height: 1.6;">
                        ${item.tips.map(tip => `<li style="margin-bottom: 6px;">${tip}</li>`).join('')}
                    </ul>
                </div>
            </div>
        </div>
    `).join('');
}

// Steuerberater Database
const steuerberaterDatabase = [
    {
        id: 1,
        name: 'Dr. Michael Wagner',
        specialty: 'Mittelstand & KMU',
        location: 'Berlin',
        rating: 4.9,
        experience: '15+ Jahre',
        languages: ['Deutsch', 'Englisch'],
        hourlyRate: 150,
        expertise: ['Umsatzsteuer', 'Jahresabschluss', 'Steueroptimierung'],
        phone: '+49 30 123456',
        email: 'm.wagner@steuer-berlin.de'
    },
    {
        id: 2,
        name: 'Sandra M√ºller',
        specialty: 'E-Commerce & Digital',
        location: 'Hamburg',
        rating: 4.8,
        experience: '10+ Jahre',
        languages: ['Deutsch', 'Englisch', 'Franz√∂sisch'],
        hourlyRate: 140,
        expertise: ['Internationale Steuer', 'Umsatzsteuer', 'Digitale Gesch√§ftsmodelle'],
        phone: '+49 40 987654',
        email: 's.mueller@steuer-hh.de'
    },
    {
        id: 3,
        name: 'Thomas Schmidt',
        specialty: 'Betriebspr√ºfung & Finanzbuchf√ºhrung',
        location: 'M√ºnchen',
        rating: 4.7,
        experience: '20+ Jahre',
        languages: ['Deutsch'],
        hourlyRate: 160,
        expertise: ['Betriebspr√ºfung', 'Finanzamt-Verhandlungen', 'Steuerstrafrecht'],
        phone: '+49 89 555777',
        email: 't.schmidt@steuer-muc.de'
    }
];

function generateSteuerberaterRecommendations() {
    const totalErhalten = steuernData.forderungen.reduce((sum, f) => sum + (f.steuer_betrag || 0), 0);
    const totalGezahlt = steuernData.zahlungen.reduce((sum, z) => sum + (z.steuer_betrag || 0), 0);
    const zahllast = totalErhalten - totalGezahlt;

    let recommendation = '';

    if (zahllast > 5000) {
        recommendation = `
            <div style="background: white; padding: 12px; border-radius: 8px; border: 1px solid var(--teal); margin-bottom: 12px;">
                <div style="font-size: 13px; font-weight: 600; color: var(--navy); margin-bottom: 4px;">Empfehlung: Steuerberatung</div>
                <div style="font-size: 12px; color: var(--gray);">
                    Bei einer Zahllast von ${formatCurrency(zahllast)} empfehlen wir eine professionelle Beratung zur Optimierung.
                </div>
            </div>
        `;
    } else if (steuernData.forderungen.filter(f => f.steuer_rate === 0).length > 3) {
        recommendation = `
            <div style="background: white; padding: 12px; border-radius: 8px; border: 1px solid var(--teal); margin-bottom: 12px;">
                <div style="font-size: 13px; font-weight: 600; color: var(--navy); margin-bottom: 4px;">Empfehlung: Spezialberatung</div>
                <div style="font-size: 12px; color: var(--gray);">
                    Mehrere steuerfreie Ums√§tze erfordern besondere Dokumentation. Ein Experte kann helfen.
                </div>
            </div>
        `;
    }

    document.getElementById('steuerberater-recommendations').innerHTML = recommendation;
}

function showSteuerberaterList() {
    const modal = document.createElement('div');
    modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
    `;

    modal.innerHTML = `
        <div style="background: white; border-radius: 16px; max-width: 900px; max-height: 80vh; overflow-y: auto; padding: 0;">
            <div style="padding: 24px; border-bottom: 1px solid var(--border-gray); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; background: white; z-index: 1;">
                <div style="font-size: 20px; font-weight: 700; color: var(--navy);">Zertifizierte Steuerberater</div>
                <button onclick="this.closest('div').closest('div').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: var(--gray);">√ó</button>
            </div>
            <div style="padding: 24px;">
                ${steuerberaterDatabase.map(sb => `
                    <div style="background: var(--light-gray); border-radius: 12px; padding: 20px; margin-bottom: 16px; border: 1px solid var(--border-gray);">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                            <div>
                                <div style="font-size: 18px; font-weight: 700; color: var(--navy); margin-bottom: 4px;">${sb.name}</div>
                                <div style="font-size: 13px; color: var(--gray); margin-bottom: 8px;">${sb.specialty}</div>
                                <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                    ${sb.expertise.map(exp => `
                                        <span style="background: white; padding: 4px 10px; border-radius: 6px; font-size: 11px; font-weight: 600; color: var(--navy); border: 1px solid var(--border-gray);">${exp}</span>
                                    `).join('')}
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 16px; font-weight: 700; color: var(--teal);">‚òÖ ${sb.rating}</div>
                                <div style="font-size: 11px; color: var(--gray);">${sb.experience}</div>
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; font-size: 12px; color: var(--gray); margin-bottom: 16px;">
                            <div>üìç ${sb.location}</div>
                            <div>üí¨ ${sb.languages.join(', ')}</div>
                            <div>üìû ${sb.phone}</div>
                            <div>üìß ${sb.email}</div>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div style="font-size: 14px; font-weight: 600; color: var(--navy);">Ab ${formatCurrency(sb.hourlyRate)}/Stunde</div>
                            <button onclick="bookConsultation(${sb.id})" style="background: var(--teal); color: white; padding: 8px 16px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 13px;">
                                Termin vereinbaren
                            </button>
                        </div>
                    </div>
                `).join('')}
            </div>
        </div>
    `;

    document.body.appendChild(modal);
}

function bookConsultation(steuerberaterId) {
    const sb = steuerberaterDatabase.find(s => s.id === steuerberaterId);
    if (!sb) return;

    alert(`Terminanfrage wird gesendet an:\n\n${sb.name}\n${sb.email}\n${sb.phone}\n\nSie erhalten in K√ºrze eine Best√§tigung per E-Mail.`);
}

// Load data when page loads
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', loadSteuernData);
} else {
    loadSteuernData();
}
</script>
